<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>adesso OCM Navigator â€“ Grow Together</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #root { height: 100%; width: 100%; }
    body { font-family: 'Fira Sans', sans-serif; background-color: #f4f6fa; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #f4f6fa; }
    ::-webkit-scrollbar-thumb { background: #887d75; border-radius: 3px; }
    @media print {
      .no-print { display: none !important; }
      main { padding: 0 !important; overflow: visible !important; }
      body { background: #fff; }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect, useCallback, useMemo } = React;

const uid = (p = "") => p + Math.random().toString(36).slice(2, 8);
const today = () => new Date().toISOString().slice(0, 10);
const fmtDate = d => d ? new Date(d).toLocaleDateString("de-DE", { day: "2-digit", month: "short", year: "numeric" }) : "â€“";
const clamp = (v, lo = 0, hi = 10) => Math.max(lo, Math.min(hi, Number(v) || 0));
const daysBetween = (a, b) => Math.round((new Date(b) - new Date(a)) / 86400000);

// â”€â”€â”€ adesso Corporate Design Theme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const T = {
  // Primary adesso Colors
  adessoBlau: "#006ec7",
  adessoGrau: "#887d75",
  // UI Colors
  bg: "#f4f6fa", surface: "#ffffff", border: "#dcdfe5", borderLight: "#edf0f5",
  text: "#222222", textSec: "#5c6178", textMut: "#887d75",
  // Secondary / Schmuckfarben (adesso CD)
  accent: "#006ec7", accentLt: "#e6f0fa", 
  success: "#76c800", successLt: "#f1fad9", // adesso GrÃ¼n
  warn: "#ff9868", warnLt: "#fff4ee",       // adesso Orange
  danger: "#e74c5e", dangerLt: "#fdeef0",   // Standard red for errors
  purple: "#461ebe", cyan: "#28dcaa", pink: "#f566ba", yellow: "#ffff00",
  shadow: "0 2px 10px rgba(0,0,0,0.05)",
  r: 4, rs: 4, font: "'Fira Sans', sans-serif",
};

// ADKAR Mapping to adesso Schmuckfarben
const ADKAR = ["Awareness", "Desire", "Knowledge", "Ability", "Reinforcement"];
const ADKAR_C = { Awareness: T.adessoBlau, Desire: T.pink, Knowledge: T.cyan, Ability: T.purple, Reinforcement: T.success };

const DIMS = ["People", "Process", "Technology", "Org"];
const DIM_IC = { People: "ðŸ‘¥", Process: "âš™ï¸", Technology: "ðŸ’»", Org: "ðŸ¢" };
const READINESS = ["supportive", "neutral", "skeptical", "resistant"];
const STATUSES = ["planned", "in_progress", "done"];
const CHANNELS = ["Townhall", "E-Mail", "Teams-Chat", "Intranet", "1:1-GesprÃ¤ch", "Workshop", "Newsletter", "Video", "Poster/Flyer"];

// â”€â”€â”€ Score helpers (0-10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const scoreColor = v => { const n = Number(v) || 0; if (n >= 8) return T.danger; if (n >= 5) return T.warn; return T.success; };
const scoreBg = v => { const n = Number(v) || 0; if (n >= 8) return T.dangerLt; if (n >= 5) return T.warnLt; return T.successLt; };
const statusColor = s => s === "done" ? T.success : s === "in_progress" ? T.accent : T.textMut;
const statusLabel = s => s === "done" ? "Fertig" : s === "in_progress" ? "In Arbeit" : "Geplant";
const readyColor = r => r === "supportive" ? T.success : r === "neutral" ? T.warn : r === "skeptical" ? T.pink : T.danger;

// â”€â”€â”€ Methods Library (Shortened for brevity) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const METHODS = [
  { id: "m1", name: "Stakeholder-Interview", category: "Analyse", adkar: ["Awareness"], effort: "Niedrig", duration: "1â€“2h pro Person", when: "FrÃ¼hphase", description: "EinzelgesprÃ¤che mit SchlÃ¼ssel-Stakeholdern.", bestFor: "Skeptische Stakeholder", steps: ["Leitfaden erstellen", "Interviews fÃ¼hren", "Auswerten"], outputs: ["Stimmungsbild"] },
  { id: "m2", name: "Impact Assessment Workshop", category: "Analyse", adkar: ["Awareness", "Knowledge"], effort: "Mittel", duration: "2â€“4h", when: "Nach Scope-Definition", description: "Workshop zur Bewertung von Auswirkungen.", bestFor: "Komplexe Changes", steps: ["Ist erfassen", "Delta identifizieren", "MaÃŸnahmen ableiten"], outputs: ["Impact-Register"] },
  { id: "m3", name: "Sponsor Roadshow", category: "Kommunikation", adkar: ["Awareness", "Desire"], effort: "Mittel", duration: "30-60 Min", when: "Vor Go-Live", description: "Sponsor besucht Teams persÃ¶nlich.", bestFor: "Hoher Widerstand", steps: ["Termine planen", "Talking Points", "Q&A"], outputs: ["Feedback"] }
];

// â”€â”€â”€ Persistence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SK = "adesso-ocm-v4";
const sv = async d => { try { localStorage.setItem(SK, JSON.stringify(d)); } catch {} };
const ld = async () => { try { const r = localStorage.getItem(SK); return r ? JSON.parse(r) : null; } catch { return null; } };
const emptyD = () => ({ initiatives: [], stakeholders: [], targetGroups: [], impactItems: [], actions: [], engagements: [], commsItems: [] });

// â”€â”€â”€ UI Components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Badge = ({ children, color = T.accent, bg: b }) => (
  <span style={{ display: "inline-flex", alignItems: "center", padding: "3px 8px", borderRadius: 4, fontSize: 11, fontWeight: 600, background: b || (color + "1A"), color, whiteSpace: "nowrap" }}>{children}</span>
);

const Btn = ({ children, onClick, v = "default", small, disabled, style: sx }) => {
  const S = { 
    default: { bg: T.surface, c: T.text, b: T.border }, 
    primary: { bg: T.accent, c: "#fff", b: T.accent }, 
    danger: { bg: T.dangerLt, c: T.danger, b: T.dangerLt }, 
    success: { bg: T.successLt, c: T.success, b: T.successLt }, 
    ghost: { bg: "transparent", c: T.textMut, b: "transparent" } 
  };
  const s = S[v] || S.default;
  return <button className="no-print" onClick={onClick} disabled={disabled} style={{ padding: small ? "4px 10px" : "8px 16px", borderRadius: T.rs, border: `1px solid ${s.b}`, background: s.bg, color: s.c, fontSize: small ? 12 : 13, fontWeight: 600, cursor: disabled ? "not-allowed" : "pointer", fontFamily: T.font, display: "inline-flex", alignItems: "center", gap: 6, opacity: disabled ? 0.5 : 1, transition: "0.2s", boxShadow: v === "default" || v === "primary" ? T.shadow : "none", ...sx }}>{children}</button>;
};

const Input = ({ label, value, onChange, options, textarea, type = "text", placeholder, style: sx, min, max, step }) => (
  <div style={{ display: "flex", flexDirection: "column", gap: 4, ...sx }}>
    {label && <label style={{ fontSize: 12, fontWeight: 600, color: T.textSec }}>{label}</label>}
    {options ? (
      <select value={value} onChange={e => onChange(e.target.value)} style={{ background: T.bg, color: T.text, border: `1px solid ${T.border}`, borderRadius: T.rs, padding: "8px", fontSize: 13, fontFamily: T.font, outline: "none" }}>
        <option value="">â€” WÃ¤hlen â€”</option>
        {options.map(o => <option key={typeof o === "string" ? o : o.value} value={typeof o === "string" ? o : o.value}>{typeof o === "string" ? o : o.label}</option>)}
      </select>
    ) : textarea ? (
      <textarea value={value} onChange={e => onChange(e.target.value)} placeholder={placeholder} rows={3} style={{ background: T.bg, color: T.text, border: `1px solid ${T.border}`, borderRadius: T.rs, padding: "8px", fontSize: 13, fontFamily: T.font, outline: "none", resize: "vertical" }} />
    ) : (
      <input type={type} value={value} onChange={e => onChange(e.target.value)} placeholder={placeholder} min={min} max={max} step={step} style={{ background: T.bg, color: T.text, border: `1px solid ${T.border}`, borderRadius: T.rs, padding: "8px", fontSize: 13, fontFamily: T.font, outline: "none" }} />
    )}
  </div>
);

const TagInput = ({ label, tags = [], onChange, placeholder }) => {
  const [val, setVal] = useState("");
  const add = () => { const n = val.trim(); if (n && !tags.includes(n)) { onChange([...tags, n]); setVal(""); } };
  const rem = (t) => onChange(tags.filter(x => x !== t));
  return (
    <div style={{ display: "flex", flexDirection: "column", gap: 4 }}>
      {label && <label style={{ fontSize: 12, fontWeight: 600, color: T.textSec }}>{label}</label>}
      <div style={{ border: `1px solid ${T.border}`, background: T.bg, borderRadius: T.rs, padding: 4, display: "flex", flexWrap: "wrap", gap: 4, alignItems: "center" }}>
        {tags.map(t => (
          <span key={t} style={{ background: T.accentLt, color: T.accent, padding: "2px 8px", borderRadius: 4, fontSize: 12, display: "flex", alignItems: "center", gap: 4 }}>
            {t} <span onClick={() => rem(t)} style={{ cursor: "pointer", fontWeight: "bold" }}>Ã—</span>
          </span>
        ))}
        <input value={val} onChange={e => setVal(e.target.value)} onKeyDown={e => e.key === "Enter" && (e.preventDefault(), add())} onBlur={add} placeholder={placeholder || "Wert tippen & Enter"} style={{ flex: 1, border: "none", background: "transparent", outline: "none", padding: "4px", fontSize: 13, fontFamily: T.font, minWidth: 120 }} />
      </div>
    </div>
  );
};

const ScoreInput = ({ label, value, onChange, style: sx }) => (
  <div style={{ display: "flex", flexDirection: "column", gap: 4, ...sx }}>
    {label && <label style={{ fontSize: 12, fontWeight: 600, color: T.textSec }}>{label}</label>}
    <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
      <input type="range" min="0" max="10" value={value} onChange={e => onChange(Number(e.target.value))} style={{ flex: 1, accentColor: scoreColor(value) }} />
      <span style={{ width: 28, height: 28, borderRadius: 4, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 700, background: scoreBg(value), color: scoreColor(value) }}>{value}</span>
    </div>
  </div>
);

const ScoreDot = ({ value, size = 28 }) => (
  <div style={{ width: size, height: size, borderRadius: 4, display: "flex", alignItems: "center", justifyContent: "center", fontSize: size < 24 ? 10 : 12, fontWeight: 700, background: scoreBg(value), color: scoreColor(value) }}>{value}</div>
);

const Card = ({ children, style: sx, onClick }) => (
  <div onClick={onClick} style={{ background: T.surface, border: `1px solid ${T.border}`, borderRadius: T.r, padding: 20, boxShadow: T.shadow, transition: "0.2s", cursor: onClick ? "pointer" : "default", ...sx }}>{children}</div>
);

const Modal = ({ open, onClose, title, children, wide }) => {
  if (!open) return null;
  return (
    <div style={{ position: "fixed", inset: 0, zIndex: 1000, display: "flex", alignItems: "center", justifyContent: "center", background: "rgba(34,34,34,0.4)", backdropFilter: "blur(3px)" }} onClick={onClose}>
      <div onClick={e => e.stopPropagation()} style={{ background: T.surface, borderRadius: 8, padding: 28, boxShadow: "0 10px 40px rgba(0,0,0,0.15)", width: wide ? "min(95vw,900px)" : "min(90vw,540px)", maxHeight: "85vh", overflowY: "auto" }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
          <h3 style={{ margin: 0, fontSize: 18, fontWeight: 700, color: T.adessoBlau }}>{title}</h3>
          <Btn v="ghost" small onClick={onClose}>âœ•</Btn>
        </div>
        {children}
      </div>
    </div>
  );
};

const Tabs = ({ tabs, active, onChange }) => (
  <div className="no-print" style={{ display: "flex", gap: 2, background: T.borderLight, borderRadius: 6, padding: 2, marginBottom: 20, overflowX: "auto" }}>
    {tabs.map(t => (
      <button key={t.key} onClick={() => onChange(t.key)} style={{ padding: "8px 16px", borderRadius: 4, border: "none", cursor: "pointer", fontSize: 13, fontWeight: active === t.key ? 600 : 400, fontFamily: T.font, background: active === t.key ? T.surface : "transparent", color: active === t.key ? T.adessoBlau : T.textSec, boxShadow: active === t.key ? T.shadow : "none", transition: "0.2s", whiteSpace: "nowrap" }}>
        {t.label}{t.count != null && <span style={{ marginLeft: 6, fontSize: 11, opacity: 0.6 }}>{t.count}</span>}
      </button>
    ))}
  </div>
);

const Empty = ({ icon, title, sub, action }) => (
  <div style={{ textAlign: "center", padding: "48px 20px" }}>
    <div style={{ fontSize: 40, marginBottom: 12, opacity: 0.5 }}>{icon}</div>
    <div style={{ fontSize: 16, fontWeight: 600, color: T.text, marginBottom: 6 }}>{title}</div>
    <div style={{ fontSize: 13, color: T.textMut, marginBottom: 18 }}>{sub}</div>
    {action}
  </div>
);

const SectionHead = ({ children }) => <div style={{ fontSize: 12, fontWeight: 700, color: T.textSec, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 12 }}>{children}</div>;

// â”€â”€â”€ ADKAR coverage calc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const adkarCov = (actions, tgId) => { const c = {}; ADKAR.forEach(a => c[a] = 0); actions.filter(a => !tgId || a.target_group_ids?.includes(tgId)).forEach(a => (a.adkar_tags || []).forEach(t => { if (c[t] !== undefined) c[t]++; })); return c; };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function App() {
  const [data, setData] = useState(emptyD());
  const [loaded, setLoaded] = useState(false);
  const [nav, setNav] = useState("dashboard");
  const [sel, setSel] = useState(null);
  const [sub, setSub] = useState("overview");

  useEffect(() => { ld().then(d => { if (d) setData({ ...emptyD(), ...d }); setLoaded(true); }); }, []);
  useEffect(() => { if (loaded) sv(data); }, [data, loaded]);

  const up = useCallback(fn => setData(p => { const n = structuredClone(p); fn(n); return n; }), []);
  const ini = useMemo(() => data.initiatives.find(i => i.id === sel), [data, sel]);
  const iSH = useMemo(() => data.stakeholders.filter(s => s.initiative_id === sel), [data, sel]);
  const iTG = useMemo(() => data.targetGroups.filter(t => t.initiative_id === sel), [data, sel]);
  const iIM = useMemo(() => data.impactItems.filter(i => i.initiative_id === sel), [data, sel]);
  const iAC = useMemo(() => data.actions.filter(a => a.initiative_id === sel), [data, sel]);
  const iENG = useMemo(() => (data.engagements || []).filter(e => e.initiative_id === sel), [data, sel]);
  const iCOM = useMemo(() => (data.commsItems || []).filter(c => c.initiative_id === sel), [data, sel]);

  // â”€â”€â”€ SMART ALERTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const alerts = useMemo(() => {
    if (!ini) return [];
    const a = [];
    const adkar = adkarCov(iAC);
    const gaps = ADKAR.filter(k => adkar[k] === 0);
    if (gaps.length > 0) a.push({ type: "warn", icon: "âš ï¸", msg: `ADKAR-LÃ¼cken: ${gaps.join(", ")} â€“ keine MaÃŸnahmen.` });
    const highResistant = iSH.filter(s => s.readiness === "resistant" && s.influence >= 7);
    highResistant.forEach(s => a.push({ type: "danger", icon: "ðŸš¨", msg: `${s.name} ist resistant (Einfluss ${s.influence}/10).` }));
    const noRecentEngagement = iSH.filter(s => s.influence >= 7).filter(s => {
      const engs = iENG.filter(e => e.stakeholder_id === s.id);
      if (engs.length === 0) return true;
      const last = engs.sort((x, y) => y.date.localeCompare(x.date))[0];
      return daysBetween(last.date, today()) > 14;
    });
    noRecentEngagement.forEach(s => a.push({ type: "warn", icon: "ðŸ¤", msg: `${s.name} (Einfluss ${s.influence}) â€“ kein Engagement >14 Tage.` }));
    return a;
  }, [ini, iSH, iAC, iIM, iTG, iENG]);

  // â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const Sidebar = () => (
    <div className="no-print" style={{ width: 250, minHeight: "100vh", background: T.surface, borderRight: `1px solid ${T.border}`, display: "flex", flexDirection: "column", flexShrink: 0 }}>
      <div style={{ padding: "24px 20px 20px", borderBottom: `1px solid ${T.borderLight}` }}>
        <div style={{ fontSize: 24, fontWeight: 700, color: T.adessoBlau, letterSpacing: -0.5, marginBottom: 2 }}>adesso</div>
        <div style={{ fontSize: 10, color: T.textMut, fontWeight: 600, letterSpacing: 1, textTransform: "uppercase" }}>GROW TOGETHER</div>
      </div>
      <div style={{ padding: "12px 20px 4px", fontSize: 11, fontWeight: 700, color: T.adessoGrau, textTransform: "uppercase" }}>OCM Navigator</div>
      <nav style={{ padding: "8px 12px", flex: 1 }}>
        {[
          { key: "dashboard", icon: "ðŸ“Š", label: "Dashboard" },
          { key: "portfolio", icon: "ðŸ“", label: "Portfolio" },
          { key: "initiative", icon: "â—‰", label: "Initiative", off: !sel },
          { key: "engagement", icon: "ðŸ¤", label: "Engagements", off: !sel },
          { key: "comms", icon: "ðŸ“£", label: "Komm.-Matrix", off: !sel },
          { key: "saturation", icon: "ðŸŒ¡ï¸", label: "Saturation", off: !sel },
          { key: "heatmap", icon: "ðŸ”¥", label: "Heatmap", off: !sel },
          { key: "report", icon: "ðŸ“‹", label: "Report", off: !sel },
          { key: "io", icon: "â†•ï¸", label: "Import / Export" },
        ].map(item => (
          <button key={item.key} disabled={item.off} onClick={() => { setNav(item.key); if (item.key === "initiative") setSub("overview"); }}
            style={{ display: "flex", alignItems: "center", gap: 10, width: "100%", padding: "10px 12px", borderRadius: T.rs, border: "none", cursor: item.off ? "not-allowed" : "pointer", textAlign: "left", background: nav === item.key ? T.accentLt : "transparent", color: nav === item.key ? T.adessoBlau : item.off ? T.borderLight : T.textSec, fontSize: 13, fontWeight: nav === item.key ? 600 : 400, fontFamily: T.font, transition: "0.2s", opacity: item.off ? 0.4 : 1, marginBottom: 2 }}>
            <span style={{ fontSize: 14, width: 20, textAlign: "center" }}>{item.icon}</span>{item.label}
          </button>
        ))}
      </nav>
      {ini && (
        <div style={{ padding: "16px 20px", borderTop: `1px solid ${T.borderLight}`, background: T.accentLt }}>
          <div style={{ fontSize: 11, fontWeight: 600, color: T.adessoBlau }}>Aktive Initiative</div>
          <div style={{ fontSize: 13, fontWeight: 700, color: T.text, marginTop: 2, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" }}>{ini.name}</div>
        </div>
      )}
    </div>
  );

  // â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DashboardView = () => {
    const tA = data.actions.length, dA = data.actions.filter(a => a.status === "done").length;
    const pct = tA ? Math.round(dA / tA * 100) : 0;
    const res = data.stakeholders.filter(s => s.readiness === "resistant" || s.readiness === "skeptical").length;
    return (
      <div>
        <h2 style={{ fontSize: 24, fontWeight: 700, color: T.adessoBlau, marginBottom: 24 }}>Portfolio Dashboard</h2>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(180px,1fr))", gap: 16, marginBottom: 24 }}>
          {[["Initiativen", data.initiatives.length, T.adessoBlau], ["Fortschritt", `${pct}%`, T.success], ["Stakeholder (Skeptisch)", res, T.warn]].map(([l, v, c]) => (
            <Card key={l} style={{ padding: 20, borderTop: `4px solid ${c}` }}>
              <div style={{ fontSize: 12, color: T.textMut, marginBottom: 6 }}>{l}</div>
              <div style={{ fontSize: 28, fontWeight: 700, color: T.text }}>{v}</div>
            </Card>
          ))}
        </div>
        <Card>
          <SectionHead>ADKAR-Abdeckung (Gesamt)</SectionHead>
          <div style={{ display: "flex", gap: 16 }}>
            {ADKAR.map(a => { const c = adkarCov(data.actions)[a]; return (
              <div key={a} style={{ flex: 1, textAlign: "center" }}>
                <div style={{ fontSize: 24, fontWeight: 700, color: ADKAR_C[a] }}>{c}</div>
                <div style={{ fontSize: 11, fontWeight: 600, color: T.textSec }}>{a}</div>
                <div style={{ background: T.bg, borderRadius: 2, height: 6, marginTop: 8 }}><div style={{ width: `${Math.min(c * 15, 100)}%`, height: "100%", background: ADKAR_C[a], borderRadius: 2 }} /></div>
              </div>
            ); })}
          </div>
        </Card>
      </div>
    );
  };

  // â”€â”€â”€ PORTFOLIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const PortfolioView = () => {
    const [show, setShow] = useState(false);
    const [f, sF] = useState({ name: "", goal: "", priority: "Medium" });
    const add = () => { if (!f.name) return; up(d => d.initiatives.push({ id: uid("INI-"), ...f, created: new Date().toISOString() })); sF({ name: "", goal: "", priority: "Medium" }); setShow(false); };
    return (
      <div>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 }}>
          <h2 style={{ fontSize: 24, fontWeight: 700, color: T.adessoBlau }}>Portfolio</h2>
          <Btn v="primary" onClick={() => setShow(true)}>ï¼‹ Neue Initiative</Btn>
        </div>
        {data.initiatives.length === 0 ? <Empty icon="ðŸ“" title="Keine Initiativen" sub="Starte dein OCM Portfolio" /> : (
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill,minmax(300px,1fr))", gap: 16 }}>
            {data.initiatives.map(i => {
              const ac = data.actions.filter(a => a.initiative_id === i.id), dn = ac.filter(a => a.status === "done").length, pc = ac.length ? Math.round(dn / ac.length * 100) : 0;
              return (
                <Card key={i.id} onClick={() => { setSel(i.id); setNav("initiative"); setSub("overview"); }} style={{ borderColor: sel === i.id ? T.adessoBlau : T.border }}>
                  <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 12 }}>
                    <div style={{ fontSize: 16, fontWeight: 700, color: T.text }}>{i.name}</div>
                    <Badge color={i.priority === "High" ? T.danger : i.priority === "Medium" ? T.warn : T.success}>{i.priority}</Badge>
                  </div>
                  <p style={{ fontSize: 13, color: T.textSec, margin: "0 0 16px", minHeight: 20 }}>{i.goal || "â€“"}</p>
                  <div style={{ background: T.bg, borderRadius: 2, height: 6, marginBottom: 6 }}><div style={{ width: `${pc}%`, height: "100%", background: T.adessoBlau, borderRadius: 2 }} /></div>
                  <div style={{ fontSize: 12, color: T.textMut }}>{pc}% â€¢ {ac.length} MaÃŸnahmen</div>
                </Card>
              );
            })}
          </div>
        )}
        <Modal open={show} onClose={() => setShow(false)} title="Neue Initiative">
          <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
            <Input label="Name" value={f.name} onChange={v => sF(p => ({ ...p, name: v }))} placeholder="z.B. ERP Migration" />
            <Input label="Ziel" value={f.goal} onChange={v => sF(p => ({ ...p, goal: v }))} textarea />
            <Input label="PrioritÃ¤t" value={f.priority} onChange={v => sF(p => ({ ...p, priority: v }))} options={["High", "Medium", "Low"]} />
            <Btn v="primary" onClick={add} style={{ alignSelf: "flex-end" }}>Speichern</Btn>
          </div>
        </Modal>
      </div>
    );
  };

  // â”€â”€â”€ INITIATIVE (Tabs) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const InitiativeView = () => {
    if (!ini) return <Empty icon="â—‰" title="Keine Initiative ausgewÃ¤hlt" sub="WÃ¤hle eine im Portfolio" />;
    const tabs = [
      { key: "overview", label: "Ãœbersicht" }, { key: "stakeholders", label: "Stakeholder", count: iSH.length },
      { key: "targets", label: "Zielgruppen", count: iTG.length }, { key: "impacts", label: "Impacts", count: iIM.length },
      { key: "actions", label: "MaÃŸnahmen", count: iAC.length }
    ];
    return (
      <div>
        <h2 style={{ fontSize: 24, fontWeight: 700, color: T.text, marginBottom: 4 }}>{ini.name}</h2>
        <p style={{ fontSize: 14, color: T.textMut, marginBottom: 20 }}>{ini.goal}</p>
        <Tabs tabs={tabs} active={sub} onChange={setSub} />
        {sub === "overview" && <OverviewSub />}
        {sub === "stakeholders" && <StakeholderSub />}
        {sub === "targets" && <TargetSub />}
        {sub === "impacts" && <ImpactSub />}
        {sub === "actions" && <ActionSub />}
      </div>
    );
  };

  const OverviewSub = () => {
    const adkar = adkarCov(iAC);
    return (
      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
        <Card>
          <SectionHead>ADKAR-Abdeckung</SectionHead>
          {ADKAR.map(a => (
            <div key={a} style={{ marginBottom: 10 }}>
              <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, marginBottom: 4 }}><span style={{ fontWeight: 600 }}>{a}</span><span>{adkar[a]}</span></div>
              <div style={{ background: T.bg, height: 6, borderRadius: 2 }}><div style={{ width: `${Math.min(adkar[a] * 20, 100)}%`, height: "100%", background: ADKAR_C[a], borderRadius: 2 }} /></div>
            </div>
          ))}
        </Card>
        <Card>
          <SectionHead>Impact nach Dimension</SectionHead>
          {DIMS.map(dim => { 
            const items = iIM.filter(i => i.dimension === dim); 
            return (
              <div key={dim} style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 10 }}>
                <span style={{ fontSize: 16 }}>{DIM_IC[dim]}</span><span style={{ width: 80, fontSize: 13, fontWeight: 500 }}>{dim}</span>
                <div style={{ flex: 1, display: "flex", gap: 4 }}>{items.map((it, i) => <ScoreDot key={i} value={it.impact_level} size={24} />)}</div>
              </div>
            ); 
          })}
        </Card>
      </div>
    );
  };

  const StakeholderSub = () => {
    const [show, setShow] = useState(false);
    const [f, sF] = useState({ name: "", roles: [], org_unit: "", influence: 5, interest: 5, readiness: "neutral" });
    const add = () => { if (!f.name) return; up(d => d.stakeholders.push({ id: uid("S-"), initiative_id: sel, ...f })); setShow(false); };
    return (
      <div>
        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 16 }}><span style={{ fontWeight: 600 }}>Stakeholder Register</span><Btn v="primary" small onClick={() => setShow(true)}>ï¼‹ Neu</Btn></div>
        <Card style={{ padding: 0, overflow: "hidden" }}>
          <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 13 }}>
            <thead><tr style={{ background: T.bg, color: T.textMut, textAlign: "left", fontSize: 11, textTransform: "uppercase" }}>
              <th style={{ padding: "10px 14px" }}>Name</th><th style={{ padding: "10px 14px" }}>Rollen</th><th style={{ padding: "10px 14px" }}>Einfluss</th><th style={{ padding: "10px 14px" }}>Readiness</th><th style={{ padding: "10px 14px" }}></th>
            </tr></thead>
            <tbody>{iSH.map(s => (
              <tr key={s.id} style={{ borderBottom: `1px solid ${T.borderLight}` }}>
                <td style={{ padding: "10px 14px", fontWeight: 500 }}>{s.name} <div style={{fontSize: 11, color: T.textMut}}>{s.org_unit}</div></td>
                <td style={{ padding: "10px 14px" }}>{(s.roles||[]).map(r => <Badge key={r} color={T.purple}>{r}</Badge>)}</td>
                <td style={{ padding: "10px 14px" }}><ScoreDot value={s.influence} /></td>
                <td style={{ padding: "10px 14px" }}><Badge color={readyColor(s.readiness)}>{s.readiness}</Badge></td>
                <td style={{ padding: "10px 14px", textAlign: "right" }}><Btn v="ghost" small onClick={() => up(d => d.stakeholders = d.stakeholders.filter(x => x.id !== s.id))}>âœ•</Btn></td>
              </tr>
            ))}</tbody>
          </table>
        </Card>
        <Modal open={show} onClose={() => setShow(false)} title="Neuer Stakeholder">
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
            <Input label="Name" value={f.name} onChange={v => sF(p => ({ ...p, name: v }))} style={{ gridColumn: "1/-1" }} />
            <TagInput label="Rollen (z.B. Sponsor, Betriebsrat)" tags={f.roles} onChange={t => sF(p => ({ ...p, roles: t }))} style={{ gridColumn: "1/-1" }} />
            <Input label="Organisationseinheit" value={f.org_unit} onChange={v => sF(p => ({ ...p, org_unit: v }))} style={{ gridColumn: "1/-1" }} />
            <ScoreInput label="Einfluss (0-10)" value={f.influence} onChange={v => sF(p => ({ ...p, influence: v }))} />
            <ScoreInput label="Interesse (0-10)" value={f.interest} onChange={v => sF(p => ({ ...p, interest: v }))} />
            <Input label="Readiness" value={f.readiness} onChange={v => sF(p => ({ ...p, readiness: v }))} options={READINESS} style={{ gridColumn: "1/-1" }} />
          </div>
          <Btn v="primary" onClick={add} style={{ marginTop: 20 }}>Speichern</Btn>
        </Modal>
      </div>
    );
  };

  const TargetSub = () => { /* Similar to original, adapted styles */
    const [show, setShow] = useState(false);
    const [f, sF] = useState({ name: "", size: "" });
    const add = () => { if (!f.name) return; up(d => d.targetGroups.push({ id: uid("TG-"), initiative_id: sel, name: f.name, size: parseInt(f.size) || 0 })); setShow(false); };
    return (
      <div>
        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 16 }}><span style={{ fontWeight: 600 }}>Zielgruppen</span><Btn v="primary" small onClick={() => setShow(true)}>ï¼‹ Neu</Btn></div>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill,minmax(250px,1fr))", gap: 16 }}>
          {iTG.map(tg => <Card key={tg.id}><div style={{ display: "flex", justifyContent: "space-between" }}><span style={{ fontWeight: 600 }}>{tg.name}</span><Btn v="ghost" small onClick={() => up(d => d.targetGroups = d.targetGroups.filter(t => t.id !== tg.id))}>âœ•</Btn></div><div style={{ fontSize: 13, color: T.textMut, marginTop: 4 }}>ðŸ‘¥ {tg.size} Personen</div></Card>)}
        </div>
        <Modal open={show} onClose={() => setShow(false)} title="Neue Zielgruppe">
          <Input label="Name" value={f.name} onChange={v => sF(p => ({...p, name:v}))} />
          <Input label="GrÃ¶ÃŸe" value={f.size} onChange={v => sF(p => ({...p, size:v}))} type="number" style={{marginTop: 16}}/>
          <Btn v="primary" onClick={add} style={{ marginTop: 20 }}>Speichern</Btn>
        </Modal>
      </div>
    );
  };

  const ImpactSub = () => {
    const [show, setShow] = useState(false);
    const [f, sF] = useState({ target_group_id: "", dimension: "People", change_description: "", impact_level: 5 });
    const add = () => { if (!f.change_description) return; up(d => d.impactItems.push({ id: uid("I-"), initiative_id: sel, ...f })); setShow(false); };
    return (
      <div>
        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 16 }}><span style={{ fontWeight: 600 }}>Impacts</span><Btn v="primary" small onClick={() => setShow(true)}>ï¼‹ Neu</Btn></div>
        <Card style={{ padding: 0 }}>
          <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 13 }}>
            <thead><tr style={{ background: T.bg, color: T.textMut, textAlign: "left", fontSize: 11, textTransform: "uppercase" }}><th style={{ padding: "10px 14px" }}>Zielgruppe</th><th style={{ padding: "10px 14px" }}>Beschreibung</th><th style={{ padding: "10px 14px" }}>Score</th><th style={{ padding: "10px 14px" }}></th></tr></thead>
            <tbody>{iIM.map(i => <tr key={i.id} style={{ borderBottom: `1px solid ${T.borderLight}` }}><td style={{ padding: "10px 14px" }}>{iTG.find(t=>t.id===i.target_group_id)?.name || "â€“"} <Badge color={T.cyan}>{i.dimension}</Badge></td><td style={{ padding: "10px 14px" }}>{i.change_description}</td><td style={{ padding: "10px 14px" }}><ScoreDot value={i.impact_level}/></td><td style={{ padding: "10px 14px", textAlign:"right" }}><Btn v="ghost" small onClick={() => up(d => d.impactItems = d.impactItems.filter(x => x.id !== i.id))}>âœ•</Btn></td></tr>)}</tbody>
          </table>
        </Card>
        <Modal open={show} onClose={() => setShow(false)} title="Neuer Impact">
          <div style={{ display: "grid", gap: 16 }}>
            <Input label="Zielgruppe" value={f.target_group_id} onChange={v => sF(p => ({ ...p, target_group_id: v }))} options={iTG.map(t => ({ value: t.id, label: t.name }))} />
            <Input label="Dimension" value={f.dimension} onChange={v => sF(p => ({ ...p, dimension: v }))} options={DIMS} />
            <Input label="Beschreibung" value={f.change_description} onChange={v => sF(p => ({ ...p, change_description: v }))} textarea />
            <ScoreInput label="Impact (0-10)" value={f.impact_level} onChange={v => sF(p => ({ ...p, impact_level: v }))} />
            <Btn v="primary" onClick={add}>Speichern</Btn>
          </div>
        </Modal>
      </div>
    );
  };

  const ActionSub = () => {
    const [show, setShow] = useState(false);
    const [f, sF] = useState({ title: "", typeTags: [], adkar_tags: [], status: "planned" });
    const togA = t => sF(p => ({ ...p, adkar_tags: p.adkar_tags.includes(t) ? p.adkar_tags.filter(x => x !== t) : [...p.adkar_tags, t] }));
    const add = () => { if (!f.title) return; up(d => d.actions.push({ id: uid("A-"), initiative_id: sel, ...f })); setShow(false); };
    const cycle = id => up(d => { const a = d.actions.find(x => x.id === id); if (a) a.status = a.status === "planned" ? "in_progress" : a.status === "in_progress" ? "done" : "planned"; });
    return (
      <div>
        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 16 }}><span style={{ fontWeight: 600 }}>MaÃŸnahmen</span><Btn v="primary" small onClick={() => setShow(true)}>ï¼‹ Neu</Btn></div>
        <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
          {iAC.map(a => (
            <Card key={a.id} style={{ padding: 14, borderLeft: `4px solid ${statusColor(a.status)}` }}>
              <div style={{ display: "flex", justifyContent: "space-between" }}>
                <div>
                  <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 8 }}>
                    <button onClick={() => cycle(a.id)} style={{ width: 24, height: 24, borderRadius: 4, border: `2px solid ${statusColor(a.status)}`, background: a.status === "done" ? T.successLt : "transparent", cursor: "pointer", color: statusColor(a.status) }}>{a.status === "done" ? "âœ“" : ""}</button>
                    <span style={{ fontSize: 14, fontWeight: 600 }}>{a.title}</span>
                    <Badge color={statusColor(a.status)}>{statusLabel(a.status)}</Badge>
                  </div>
                  <div style={{ display: "flex", gap: 6 }}>
                    {(a.typeTags||[]).map(t => <Badge key={t} color={T.adessoGrau}>{t}</Badge>)}
                    {(a.adkar_tags||[]).map(t => <Badge key={t} color={ADKAR_C[t]}>{t}</Badge>)}
                  </div>
                </div>
                <Btn v="ghost" small onClick={() => up(d => d.actions = d.actions.filter(x => x.id !== a.id))}>âœ•</Btn>
              </div>
            </Card>
          ))}
        </div>
        <Modal open={show} onClose={() => setShow(false)} title="Neue MaÃŸnahme">
          <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
            <Input label="Titel" value={f.title} onChange={v => sF(p => ({ ...p, title: v }))} />
            <TagInput label="Typ (z.B. Workshop, Training)" tags={f.typeTags} onChange={t => sF(p => ({ ...p, typeTags: t }))} />
            <div>
              <label style={{ fontSize: 12, fontWeight: 600, color: T.textSec }}>ADKAR Fokus</label>
              <div style={{ display: "flex", gap: 6, marginTop: 6 }}>{ADKAR.map(a => <button key={a} onClick={() => togA(a)} style={{ padding: "6px 10px", borderRadius: 4, border: "none", cursor: "pointer", fontSize: 12, fontWeight: 600, background: f.adkar_tags.includes(a) ? ADKAR_C[a] : T.borderLight, color: f.adkar_tags.includes(a) ? "#fff" : T.textMut }}>{a}</button>)}</div>
            </div>
            <Btn v="primary" onClick={add}>Speichern</Btn>
          </div>
        </Modal>
      </div>
    );
  };

  // â”€â”€â”€ IMPORT / EXPORT (With CSV) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const IOView = () => {
    const doCsvExp = (type) => {
      let rows = [];
      if (type === "stakeholder") {
        rows = [["ID", "Name", "Rollen", "OE", "Einfluss", "Interesse", "Readiness"]];
        data.stakeholders.forEach(s => rows.push([s.id, s.name, (s.roles||[]).join(", "), s.org_unit, s.influence, s.interest, s.readiness]));
      } else {
        rows = [["ID", "Titel", "Status", "Tags", "ADKAR"]];
        data.actions.forEach(a => rows.push([a.id, a.title, a.status, (a.typeTags||[]).join(", "), (a.adkar_tags||[]).join(", ")]));
      }
      const csv = rows.map(r => r.map(c => `"${String(c||'').replace(/"/g, '""')}"`).join(";")).join("\n");
      const b = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const a = document.createElement("a"); a.href = URL.createObjectURL(b); a.download = `adesso_${type}_export.csv`; a.click();
    };

    return (
      <div>
        <h2 style={{ fontSize: 24, fontWeight: 700, color: T.adessoBlau, marginBottom: 20 }}>Import / Export</h2>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
          <Card>
            <SectionHead>JSON Export (Backup)</SectionHead>
            <Btn v="primary" onClick={() => { const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: "application/json"})); a.download = "ocm-backup.json"; a.click(); }}>ðŸ“¦ Komplettes Backup laden</Btn>
          </Card>
          <Card>
            <SectionHead>CSV Export (FÃ¼r Excel)</SectionHead>
            <div style={{display: "flex", gap: 10}}>
              <Btn onClick={() => doCsvExp("stakeholder")}>ðŸ“Š Stakeholder (CSV)</Btn>
              <Btn onClick={() => doCsvExp("actions")}>ðŸ“Š MaÃŸnahmen (CSV)</Btn>
            </div>
          </Card>
        </div>
      </div>
    );
  };

  // RENDER ROUTING
  const views = { dashboard: DashboardView, portfolio: PortfolioView, initiative: InitiativeView, io: IOView };
  const V = views[nav] || (() => <Empty icon="ðŸš§" title="Im Aufbau" sub="Dieser Bereich wird noch an das neue CD angepasst." />);

  return (
    <div style={{ display: "flex", minHeight: "100vh", background: T.bg, color: T.text }}>
      <Sidebar />
      <main style={{ flex: 1, padding: "32px 40px", overflowY: "auto", maxHeight: "100vh" }}>
        <V />
      </main>
    </div>
  );
}

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(React.createElement(App));
  </script>
</body>
</html>
